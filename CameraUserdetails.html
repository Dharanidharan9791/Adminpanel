<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Details - SIONYX Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="cameraUserdetails.css">

    <link rel="stylesheet" href="sidebar.css">
    <link rel="stylesheet" href="userdetails.css">
    <link rel="stylesheet" href="https://use.typekit.net/rxm7ono.css">
</head>
<style>
    * {
        font-family: proxima-nova, sans-serif !important;
        font-style: normal;


        @-webkit-keyframes fadein {
            from {
                bottom: 0;
                opacity: 0;
            }

            to {
                bottom: 30px;
                opacity: 1;
            }
        }

        @keyframes fadein {
            from {
                bottom: 0;
                opacity: 0;
            }

            to {
                bottom: 30px;
                opacity: 1;
            }
        }

        @-webkit-keyframes fadeout {
            from {
                bottom: 30px;
                opacity: 1;
            }

            to {
                bottom: 0;
                opacity: 0;
            }
        }

        @keyframes fadeout {
            from {
                bottom: 30px;
                opacity: 1;
            }

            to {
                bottom: 0;
                opacity: 0;
            }
        }



        .spinner {
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-left-color: #333;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            margin-left: 79px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

    }
</style>

<script>
    function myFunction() {
        var snackbar = document.getElementById("snackbar");
        snackbar.style.display = "block";

        centerSnackbar();

        setTimeout(function () { snackbar.style.display = "none"; }, 3000);
    }

    function centerSnackbar() {
        var snackbar = document.getElementById("snackbar");
        var leftPosition = (window.innerWidth - snackbar.offsetWidth) / 2;
        snackbar.style.left = leftPosition + "px";
    }


    // Recenter the snackbar when the window is resized
    window.addEventListener("resize", function () {
        centerSnackbar();
    });
</script>





<body>
    <div class="wrapper">
        <div class="sidebar" id="sidebar">
            <div class="logosionyx">
                <!-- <img src="Logo.png" alt="SIONYX Logo" style="filter: brightness(650%);" height="50px" width="150px"> -->
                <div class="sionyxLogoIcon"></div>
            </div>

            <br>
            <div class="redirect-container">
                <a href="https://sionyxadminpanel.s3.us-east-2.amazonaws.com/Adminpanel/UserDetails.html"
                    id="dashboard-link"
                    style="margin-bottom: 15px; color: rgb(12, 12, 12); background-color: white; text-decoration: none">
                    <div style="display: inline-block;text-overflow:ellipsis"
                        onmouseout="document.getElementById('dashboard-link').style.color='black'">
                        <i class="fas fa-tachometer-alt icon" style="color: #333;"></i>Dashboard
                    </div>
                </a>

                </a>
                <a href="#" onclick="myFunction()"><i class="fas fa-user-plus icon"></i>Add User</a>
                <div id="snackbar">Still in implementation!</div>

            </div>

            <div class="footer">

                <div class="profile footerUserDetails">
                    <div class="userIcon">
                        <img src="profile_pic.png" alt="Administrator" style="width: 38px;height:38px">

                    </div>
                    <div class="userDetails">
                        <div id="profile-username"> </div>
                        <div id="admintext">Administrator</div>
                    </div>
                    <div class="logoutContainer">
                        <i class="fas fa-sign-out-alt icon" id="logoutadmin" onclick="openModal()"
                            style="font-size: 20px"></i>
                    </div>

                </div>
            </div>

        </div>

        <div id="sidebarOffCanvas" style="display: none;" class="offCanvasMenu">
            <div class="canvasHeader">

                <div class="logoContainer">
                    <!-- <img src="Logo.png" alt="SIONYX Logo" style="filter: brightness(650%);" class="sionyxLogoIcon" height="50px" width="150px"> -->
                    <div class="sionyxLogoIcon"></div>
                </div>
                <div class="closetnContainer">
                    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
                </div>
            </div>

            <div class="redirect-container">
                <a href="https://sionyxadminpanel.s3.us-east-2.amazonaws.com/Adminpanel/UserDetails.html"
                    id="dashboard-link"
                    style="margin-bottom: 15px; color: rgb(12, 12, 12); background-color: white; text-decoration: none">
                    <div style="display: inline-block;text-overflow:ellipsis"
                        onmouseout="document.getElementById('dashboard-link').style.color='black'">
                        <i class="fas fa-tachometer-alt icon" style="color: #333;"></i>Dashboard
                    </div>
                </a>

                <a href="#" onclick="myFunction()"><i class="fas fa-user-plus icon"
                        style="color: rgb(148, 148, 148)"></i>Add User</a>
                <div id="snackbarMob">Still in implementation!</div>
                <div id="snackbar1"></div>
            </div>
            <div class="footer">
                <div class="profile footerUserDetails">
                    <div class="userIcon">
                        <img src="profile_pic.png" id="userIcon" alt="Administrator">

                    </div>
                    <div class="userDetails">
                        <div id="profile-usernames"> </div>
                        <div id="admintext">Administrator</div>
                    </div>
                    <div class="logoutContainer">
                        <i class="fas fa-sign-out-alt icon" id="logoutadmin" onclick="openModal()"
                            style="font-size: 20px"></i>
                    </div>

                </div>
            </div>
        </div>


        <!-- <span id ="BurgerIcon" style="font-size:30px;cursor:pointer" onclick="openNav()">&#9776;</span>  -->

        <div class="">

            <div class="headerContainer">
                <div class="headingConatainer">
                    <span id="BurgerIcon" style="font-size:30px;cursor:pointer" onclick="openNav()">&#9776;</span>
                    <h2 class="topHeader">Details</h2>
                </div>
                <div class="search-container" id="BurgerIcon">
                    <span class="clicked-user"></span>
                    <input type="text" class="search-input" id="search-input" placeholder="Search Serial Number...">
                </div>
            </div>



            <div class="content-box">

                <div class="user-status">
                    <div class="back-btn-box" width="30px" data-page="">
                        <i class="fas fa-angle-left" style="font-size:27px; opacity: 0.5; transition: opacity 0.3s;"
                            onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'"></i>
                    </div>
                    <p class="username" id="username"></p>
                </div>

                <div class="search-container result-info">
                    <span class="clicked-user"></span>
                    <input type="text" class="search-input" id="search-input1" placeholder="Search Serial Number...">
                </div>
                <div id="no-cameras-message" style="display: none; color:black; text-align: center;">
                    No cameras found.
                </div>
                <div class="user-table-container" >

                    <div id="bodyTableContainer" class="bodyTableContainer camerabodyTableContainer">
                        <table class="user-table" id="camera-table">
                            <thead>
                                <tr>
                                    <th style="text-align: center;">Camera</th>
                                    <th style="text-align: center;">Serial Number</th>
                                    <th style="text-align: center;">Classification</th>
                                    <th style="text-align: center;">SKU</th>

                                </tr>
                            </thead>
                            <tbody id="camera-details-body">

                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="no-cameras-message" style="display: none; color:black; text-align: center;">
                    No cameras found.
                </div>
            </div>

        </div>


        <div id="Logout-modal">
            <div class="Logout-content">
                <p><b>Are you sure you want to logout?</b></p>
                <div class="button-container">
                    <button class="logout-btn" id="logout-btn" style="top: 318px; left: 751px; width: 200px; height: 47px; background: #ac0000 0% 0% no-repeat padding-box; border-radius: 5px; opacity: 1; border:none; margin-right: 20px;
                    color: white;" onmouseover="this.style.backgroundColor='#ff3333'"
                        onmouseout="this.style.backgroundColor='#D80000'"> <span id="logout-text">Logout</span>
                        <span id="logout-spinner" style="display: none; "><i class="fas fa-spinner fa-spin"></i></span>
                    </button>

                    <button class="logout-Cancel-btn" onclick="closeModal()"
                        style="top: 318px;  width: 200px; height: 47px; background: #FFFFFF 0% 0% no-repeat padding-box; border: 1px solid #252525; border-radius: 5px; opacity: 1;"
                        onmouseover="this.style.backgroundColor='#999'"
                        onmouseout="this.style.backgroundColor='#FFFFFF'">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    <div id="pagination-container"></div>
</body>

</html>



<script>
    function openNav() {
        document.getElementById("sidebarOffCanvas").style.display = "flex";
        // document.getElementById("BurgerIcon").style.display = "block";
    }

    function closeNav() {
        document.getElementById("sidebarOffCanvas").style.display = "none";
        // document.getElementById("BurgerIcon").style.display = "block";
    }
    function LogoutSpinner() {
        var button = document.getElementById('logout-btn');
        button.innerHTML = '<div class="spinner"></div>';

    }
    document.addEventListener('DOMContentLoaded', function () {

        if (!localStorage.getItem('sessionToken')) {
            window.location.href = "AdminLogin.html";
        } else {
            parseQueryParameters();
        }
    });

    window.addEventListener('popstate', function (event) {
        if (!localStorage.getItem('sessionToken')) {
            // window.location.href = "AdminLogin.html";
            window.location.href = "https://sionyxadminpanel.s3.us-east-2.amazonaws.com/Adminpanel/AdminLogin.html";

        }
    });

    function parseQueryParameters() {
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const details = {
            "Auora": safeJSONParse(urlParams.get('Auora')),
            "Opsin": safeJSONParse(urlParams.get('Opsin')),
            "Nightwave": safeJSONParse(urlParams.get('Nightwave')),
            "Serial_Number": urlParams.getAll('Serial_Number'),
            "Classification": urlParams.getAll('Classification'),
            "SKU": urlParams.getAll('SKU'),
            "Last_Used": urlParams.getAll('Last_Used'),
            "username": urlParams.get('username'),

            "active_status": urlParams.get('active_status'),
            "email": urlParams.get('email'),
            "utc_timestamp": urlParams.get('utc_timestamp')
        };
        return details;
    }

    function safeJSONParse(str) {
        try {
            return JSON.parse(str || "[]");
        } catch (e) {
            console.error("Error parsing JSON:", e);
            return [];
        }
    }

    function displayUserDetails(details) {
        const userDetailsDiv = document.getElementById('user-details');

        const username = details.username;
        const email = details.email;
        const activeStatus = details.active_status;

        let statusText, statusColor;
        if (activeStatus === 'Active') {
            statusText = 'Active';
            statusColor = 'green'; // Color for active status and dot
        } else {
            statusText = 'Offline';
            statusColor = 'red'; // Color for offline status and dot
        }

        // Update username next to back button
        const backUsernameSpan = document.getElementById('username');
        // Append status dot, username with respective colors, and status text
        backUsernameSpan.innerHTML = `<div style='display:flex;align-items:center;gap:5px'><b>${username} </b><span class="status-dot" style="background-color: ${statusColor};"></span><span class="user-email" style="font-size: 14px; background-color: #ffecec; color: ${statusColor};">${statusText}</span></div>`;

        // Append email on the next line
        backUsernameSpan.innerHTML += `<div class="user-email" style="font-size: 17px; opacity: 0.5;">${email}</div>`;

        function getNameFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('name');
        }

        // Update profile username in sidebar
        const profileUsernameSpan = document.getElementById('profile-username');
        const profileUsername = document.getElementById('profile-usernames');
        if (profileUsernameSpan) {
            const name = getNameFromURL(); // Retrieve the name from URL
            profileUsernameSpan.textContent = name;
            profileUsername.textContent = name;

            localStorage.setItem('name', name);
            console.log(name)


        } else {
            console.error('Profile username span not found.');
        }

        populateCameraDetailsTable(details);
    }

    function populateCameraDetailsTable(details) {
        const tableBody = document.getElementById("camera-details-body");
        let camerasFound = false; // Flag to track if any cameras are found

        for (let key in details) {
            if (["Auora", "Opsin", "Nightwave"].includes(key)) {
                const cameras = details[key];
                cameras.forEach(camera => {
                    camerasFound = true; // Cameras are found
                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <td  style="text-align:center">${camera.model || ''}</td>
                    <td  style="text-align:center">${camera.serialNumber || ''}</td>
                    <td  style="text-align:center">${camera.classification || ''}</td>
                    <td  style="text-align:center">${camera.SKU || ''}</td>
                `;
                    tableBody.appendChild(row);
                });
            }
        }

        console.log("Cameras found:", camerasFound);

        // If no cameras are found, display a message
        if (!camerasFound) {
            const content = document.getElementById("bodyTableContainer");
            const table = document.getElementById("camera-table");
            table.style.display = "none"
            const searchcontainer = document.getElementById("search-input");
            searchcontainer.style.display = "none"
            const searchcontainer1 = document.getElementById("search-input1");
            searchcontainer1.style.display = "none"
            //  const messageRow = document.createElement("tr");
            const messageCell = document.createElement("div");
            // messageCell.setAttribute("colspan", "4");
            messageCell.style.textAlign = "center";
            //  messageCell.style.marginLeft = "2in";// Align text to center
            messageCell.style.padding = "40px";
            messageCell.style.paddingLeft = "60px";

            messageCell.textContent = `No Device available for User ${details.username}`;
            messageCell.padding = "50px";
            // messageRow.appendChild(messageCell);
            content.appendChild(messageCell);
        }
    }





    function getNameFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('name');
    }






    function openModal() {
        const confirmationModal = document.getElementById('Logout-modal');
        if (confirmationModal) {
            confirmationModal.style.display = 'flex';
            const logoutButton = document.getElementById('logout-btn');

            const cancelButton = document.querySelector('.logout-Cancel-btn');
            username = getNameFromURL();
            if (logoutButton) {
                logoutButton.addEventListener('click', () => {
                    cancelButton.classList.add('disabled')
                    logout(username);
                    LogoutSpinner()

                });
            }
            console.log("djksfbkjsdbf");
        } else {
            console.error('Confirmation modal not found.');

        }
    }



    function closeModal() {
        const confirmModal = document.getElementById('Logout-modal');
        if (confirmModal) {
            confirmModal.style.display = 'none';
        } else {
            console.error('Confirmation modal not found.');
        }
    }


    document.getElementById('dashboard-link').addEventListener('click', function (event) {
        event.preventDefault(); // Prevent the default link behavior

        // Hide user table
        const userTable = document.querySelector('.user-table-container');
        if (userTable) {
            userTable.style.display = 'none';
        } else {
            console.error('User table container not found.');
        }


        const loadingText = document.getElementById('loading-text');
        if (loadingText) {
            loadingText.style.display = 'block';
        } else {
            console.error('Loading text element not found.');
        }


        setTimeout(() => {
            window.location.href = "UserDetails.html";
        }, 1000);
    });



    document.addEventListener('DOMContentLoaded', function () {
        const backButton = document.querySelector('.back-btn-box');
        const urlParams = new URLSearchParams(window.location.search);
        const page = urlParams.get('page');
        backButton.setAttribute('data-page', page); // Set the value of data-page attribute

        backButton.addEventListener('click', function () {
            const page = backButton.getAttribute('data-page');
            redirectToUserDetailsPage(page);
        });

        function redirectToUserDetailsPage(page) {
            window.location.href = `UserDetails.html?page=${page}`;
        }
    });







    document.addEventListener('DOMContentLoaded', function () {
        const details = parseQueryParameters();
        displayUserDetails(details);
    });

    function myFunction() {
        var x = document.getElementById("snackbar");
        var y = document.getElementById("snackbarMob");

        y.className = "show";
        x.style.visibility = 'visible'
        y.style.visibility = 'visible'
        setTimeout(function () {
            x.style.visibility = 'hidden'
            y.style.visibility = 'hidden'

        }, 3000);
    }




    /* function filterCameras() {
         const input = document.querySelector('.search-input');
         const filter = input.value.toUpperCase();
         const tableBody = document.getElementById('camera-details-body');
         const rows = tableBody.getElementsByTagName('tr');
         let camerasFound = false; // Flag to track if any cameras are found
     
         for (let i = 0; i < rows.length; i++) {
             const serialNumberCell = rows[i].getElementsByTagName('td')[1];
             if (serialNumberCell) {
                 const txtValue = serialNumberCell.textContent || serialNumberCell.innerText;
                 if (txtValue.toUpperCase().indexOf(filter) > -1) {
                     rows[i].style.display = '';
                     camerasFound = true; // Set the flag to true if at least one camera is found
                 } else {
                     rows[i].style.display = 'none';
                 }
             }
         }
     
         // Show or hide the "No cameras found" message based on the flag
         const noCamerasMessage = document.getElementById('no-cameras-message');
         if (noCamerasMessage) {
             if (camerasFound) {
                 noCamerasMessage.style.display = 'none'; // Hide message if cameras are found
             } else {
                 noCamerasMessage.style.display = 'block'; // Show message if no cameras are found
             }
         }
     }
 
     // Add event listener to the search input
 
 
     document.querySelector('.search-input').addEventListener('input', filterCameras); */

    document.querySelector('#search-input').addEventListener('input', function (event) {
        console.log("lol")
        const inputValue = event.target.value;
        const filteredValue = inputValue.replace(/[^\w]/g, ''); // Remove special characters and spaces

        // Update input value without special characters and spaces
        event.target.value = filteredValue;

        // List all users when attempting to enter special characters or spaces
        if (filteredValue !== inputValue) {
            filterCameras(); // Call the filterUsers function to list all users
        }
    });

    document.querySelector('#search-input1').addEventListener('input', function (event) {
        console.log("lol")
        const inputValue = event.target.value;
        const filteredValue = inputValue.replace(/[^\w]/g, ''); // Remove special characters and spaces

        // Update input value without special characters and spaces
        event.target.value = filteredValue;
        console.log("value", filteredValue, event.target.value)
        // List all users when attempting to enter special characters or spaces
        if (filteredValue !== inputValue) {
            filterCameras1(); // Call the filterUsers function to list all users
        }
    });



    function filterCameras() {
        const input = document.querySelector('#search-input');
        const filter = input.value.toUpperCase();
        const tableBody = document.getElementById('camera-details-body');
        const rows = tableBody.getElementsByTagName('tr');
        let camerasFound = false; // Flag to track if any cameras are found

        for (let i = 0; i < rows.length; i++) {
            const serialNumberCell = rows[i].getElementsByTagName('td')[1];
            const modelCell = rows[i].getElementsByTagName('td')[2]; // Adjust index for the model column

            if (serialNumberCell && modelCell) {
                const serialNumberTxtValue = serialNumberCell.textContent || serialNumberCell.innerText;
                const modelTxtValue = modelCell.textContent || modelCell.innerText;

                // Check if any character of the filter matches the corresponding character in the serial number or model
                let match = true;
                for (let j = 0; j < filter.length; j++) {
                    const filterChar = filter[j];
                    if (serialNumberTxtValue[j] !== filterChar && modelTxtValue[j] !== filterChar) {
                        match = false;
                        break;
                    }
                }

                if (match) {
                    rows[i].style.display = '';
                    camerasFound = true; // Set the flag to true if at least one camera is found
                } else {
                    rows[i].style.display = 'none';
                }
            }
        }

        // Show or hide the "No cameras found" message based on the presence of matching cameras
        const noCamerasMessage = document.getElementById('no-cameras-message');
        if (!camerasFound) {
            noCamerasMessage.style.display = 'block'; // Show the message if no cameras are found
        } else {
            noCamerasMessage.style.display = 'none'; // Hide the message if there are matching cameras
        }
    }

    function filterCameras1() {
        const input = document.querySelector('#search-input1');
        const filter = input.value.toUpperCase();
        const tableBody = document.getElementById('camera-details-body');
        const rows = tableBody.getElementsByTagName('tr');
        let camerasFound = false; // Flag to track if any cameras are found

        for (let i = 0; i < rows.length; i++) {
            const serialNumberCell = rows[i].getElementsByTagName('td')[1];
            const modelCell = rows[i].getElementsByTagName('td')[2]; // Adjust index for the model column

            if (serialNumberCell && modelCell) {
                const serialNumberTxtValue = serialNumberCell.textContent || serialNumberCell.innerText;
                const modelTxtValue = modelCell.textContent || modelCell.innerText;

                // Check if any character of the filter matches the corresponding character in the serial number or model
                let match = true;
                for (let j = 0; j < filter.length; j++) {
                    const filterChar = filter[j];
                    if (serialNumberTxtValue[j] !== filterChar && modelTxtValue[j] !== filterChar) {
                        match = false;
                        break;
                    }
                }

                if (match) {
                    rows[i].style.display = '';
                    camerasFound = true; // Set the flag to true if at least one camera is found
                } else {
                    rows[i].style.display = 'none';
                }
            }
        }

        // Show or hide the "No cameras found" message based on the presence of matching cameras
        const noCamerasMessage = document.getElementById('no-cameras-message');
        if (!camerasFound) {
            noCamerasMessage.style.display = 'block'; // Show the message if no cameras are found
        } else {
            noCamerasMessage.style.display = 'none'; // Hide the message if there are matching cameras
        }
    }





    // Add event listener to the search input


    document.querySelector('#search-input').addEventListener('input', filterCameras);
    document.querySelector('#search-input1').addEventListener('input', filterCameras1);








    function logout(username) {
        console.log("Logging out user:", username);
        const cancelButton = document.querySelector('.logout-Cancel-btn');

        // Send the logout request
        fetch('https://p9p8zffjs0.execute-api.us-east-2.amazonaws.com/Sionyx/Signout-admin', {
            method: 'POST',
            mode: 'no-cors',  // Sending request in 'no-cors' mode
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username })
        })
            .then(() => {
                cancelButton.classList.remove('disabled')
                window.location.href = "AdminLogin.html";
                localStorage.removeItem('sessionToken');
                localStorage.removeItem('username');
                sessionStorage.clear();
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);

            });
    }

</script>