<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIONYX Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap"> -->
    <link rel="stylesheet" href="https://use.typekit.net/rxm7ono.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

    <script src="userdetails.js"></script>
    <link rel="stylesheet" href="userdetails.css">
    <link rel="stylesheet" href="sidebar.css">
    <link rel="stylesheet" href="spinner.css">
</head>
<style>
    * {
        font-family: proxima-nova, sans-serif !important;
        font-style: normal;
    }
</style>
<body>
    <body>
        <div class="wrapper">
            <div class="sidebar" id="sidebar">
                <div class="logosionyx">
                    <div class="sionyxLogoIcon"></div>
                </div>
                <br>
                <div class="redirect-container">
                    <a id="dashboard-link"
        href="Dashboard.html"
        style="margin-bottom: 15px; color: rgb(12, 12, 12); background-color: white; text-decoration: none">
        <div style="display: inline-block;text-overflow:ellipsis"
            onmouseout="document.getElementById('dashboard-link').style.color='black'">
            <i class="fas fa-tachometer-alt icon" style="color: #333;"></i>Dashboard
        </div>
    </a>
    
                    <a href="UserDetails.html" ><i class="fas fa-user-plus icon"
                        style="color: rgb(148, 148, 148)"></i>Users</a>
                    <a href="#" onclick="myFunction()"><i class="fas fa-user-plus icon"
                            style="color: rgb(148, 148, 148)"></i>Add User</a>
                    <div id="snackbar">Still in implementation!</div>
                    <div id="snackbar1"></div>
                </div>
                <div class="footer">
                    <div class="profile footerUserDetails">
                        <div class="userIcon">
                            <img src="profile_pic.png" id="userIcon" alt="Administrator">
    
                        </div>
                        <div class="userDetails">
                            <div id="profile-username"> </div>
                            <div id="admintext">Administrator</div>
                        </div>
                        <div class="logoutContainer">
                            <i class="fas fa-sign-out-alt icon" id="logoutadmin" onclick="openModal()"
                                style="font-size: 20px"></i>
                        </div>
    
                    </div>
                </div>
    
            </div>
            <div id="sidebarOffCanvas" style="display: none;" class="offCanvasMenu">
                <div class="canvasHeader">
    
                    <div class="logoContainer">
                        <!-- <img src="Logo.png" alt="SIONYX Logo" style="filter: brightness(650%);" class="sionyxLogoIcon" height="50px" width="150px"> -->
                        <div class="sionyxLogoIcon"></div>
                    </div>
                    <div class="closetnContainer">
                        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
                    </div>
                </div>
    
                <div class="redirect-container">
                    <a href="https://sionyxadminpanel.s3.us-east-2.amazonaws.com/Adminpanel/UserDetails.html"
                        id="dashboard-link"
                        style="margin-bottom: 15px; color: rgb(12, 12, 12); background-color: white; text-decoration: none">
                        <div style="display: inline-block;text-overflow:ellipsis"
                            onmouseout="document.getElementById('dashboard-link').style.color='black'">
                            <i class="fas fa-tachometer-alt icon" style="color: #333;"></i>Dashboard
                        </div>
                    </a>
                   
                    <a href="#" onclick="myFunction()"><i class="fas fa-user-plus icon"
                            style="color: rgb(148, 148, 148)"></i>Add User</a>
                    <div id="snackbarMob">Still in implementation!</div>
                    <div id="snackbar1"></div>
                </div>
                <div class="footer">
                    <div class="profile footerUserDetails">
                        <div class="userIcon">
                            <img src="profile_pic.png" id="userIcon" alt="Administrator">
    
                        </div>
                        <div class="userDetails">
                            <div id="profile-usernames"> </div>
                            <div id="admintext">Administrator</div>
                        </div>
                        <div class="logoutContainer">
                            <i class="fas fa-sign-out-alt icon" id="logoutadmin" onclick="openModal()"
                                style="font-size: 20px"></i>
                        </div>
    
                    </div>
                </div>
            </div>
    
            
    
    
                
    
                    
                </div>
    
    
    
    
            </div>
    
    
    
    
    
            
    
    
    
    
    
    
    
            <div id="spinner" class="lds-ring" style="display: none;">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
    
           
           
    
            <div id="Logout-modal">
                <div class="Logout-content">
                    <p><b>Are you sure you want to logout?</b></p>
                    <div class="button-container">
                        <button class="logout-btn" id="logout-btn" style="top: 318px; left: 751px; width: 200px; height: 47px; background: #ac0000 0% 0% no-repeat padding-box; border-radius: 5px; opacity: 1;      margin-right: 20px;
                    color: white;" onmouseover="this.style.backgroundColor='#ff3333'"
                            onmouseout="this.style.backgroundColor='#D80000'"> <span id="logout-text">Logout</span>
                            <span id="logout-spinner" style="display: none;"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
    
    
                        <button class="logout-Cancel-btn" onclick="closeModal()"
                            style="top: 318px; left: 966px; width: 200px; height: 47px; background: #FFFFFF 0% 0% no-repeat padding-box; border: 1px solid #252525; border-radius: 5px; opacity: 1;"
                            onmouseover="this.style.backgroundColor='#999'"
                            onmouseout="this.style.backgroundColor='#FFFFFF'">Cancel</button>
                    </div>
                </div>
            </div>
    
    
    
           
            
        </div>
    
    



</body>
</html>

<script>
    let usersData = null;
    function openNav() {
        document.getElementById("sidebarOffCanvas").style.display = "flex";
        // document.getElementById("BurgerIcon").style.display = "block";
    }

    function closeNav() {
        document.getElementById("sidebarOffCanvas").style.display = "none";
        // document.getElementById("BurgerIcon").style.display = "block";
    }
    document.addEventListener('DOMContentLoaded', function () {

        if (!localStorage.getItem('sessionToken')) {
            window.location.href = "AdminLogin.html";
            // window.location.href = "https://sionyxadminpanel.s3.us-east-2.amazonaws.com/Adminpanel/AdminLogin.html";
        } else {
            fetchAndPopulateUserList();
        }
    });

    window.addEventListener('popstate', function (event) {
        if (!localStorage.getItem('sessionToken')) {
            window.location.href = "AdminLogin.html";
            //window.location.href = "https://sionyxadminpanel.s3.us-east-2.amazonaws.com/Adminpanel/AdminLogin.html";
        }
    });
    const SESSION_TIMEOUT = 15 * 60 * 1000; // 15 minutes

    let sessionTimer;

    function resetSessionTimer() {
        clearTimeout(sessionTimer);
        sessionTimer = setTimeout(logoutUser, SESSION_TIMEOUT);
    }

    function logoutUser() {
        // Perform logout actions here, such as redirecting to the logout page
        localStorage.removeItem('sessionToken');
        //window.location.href = "https://sionyxadminpanel.s3.us-east-2.amazonaws.com/Adminpanel/AdminLogin.html";
        window.location.href = "AdminLogin.html";

    }
    const logoutIcon = document.getElementById('logoutadmin');
    if (logoutIcon) {
        logoutIcon.addEventListener('click', () => {
            const confirmationModal = document.getElementById('confirm-modal');
            if (confirmationModal) {
                confirmationModal.style.display = 'flex';
            } else {
                console.error('Confirmation modal not found.');
            }
        });
    } else {
        console.error('Logout icon not found.');
    }




    const logoutNoButton = document.getElementById('logoutadmin');
    if (logoutNoButton) {
        logoutNoButton.addEventListener('click', () => {
            const confirmationModal = document.getElementById('Logout-modal');
            if (confirmationModal) {
                confirmationModal.style.display = 'none';
            } else {
                console.error('Confirmation modal not found.');
            }
        });
    } else {
        console.error('Logout No button not found.');
    }
    // Function to close the confirmation modal



    function openModal() {
        const confirmationModal = document.getElementById('Logout-modal');
        if (confirmationModal) {
            confirmationModal.style.display = 'flex';
            const logoutButton = document.getElementById('logout-btn');
            const cancelButton = document.querySelector('.logout-Cancel-btn');

            username = getNameFromURL();
            if (logoutButton) {
                logoutButton.addEventListener('click', () => {
                    cancelButton.classList.add('disabled')
                    LogoutSpinner()
                    logout(username);


                });
            }
            console.log("djksfbkjsdbf");
        } else {


            console.error('Confirmation modal not found.');

        }
    }
    function closeModal() {
        const confirmModal = document.getElementById('Logout-modal');
        if (confirmModal) {
            confirmModal.style.display = 'none';
        } else {
            console.error('Confirmation modal not found.');
        }
    }




    function myFunction() {
        var x = document.getElementById("snackbar");
        var y = document.getElementById("snackbarMob");

        y.className = "show";
        x.style.visibility = 'visible'
        y.style.visibility = 'visible'
        setTimeout(function () {
            x.style.visibility = 'hidden'
            y.style.visibility = 'hidden'

        }, 3000);
    }




    function showSpinnerAndRedirect() {
        const spinner = document.getElementById('spinner');
        spinner.style.display = 'block';



        setTimeout(() => {

            window.location.href = "https://sionyxadminpanel.s3.us-east-2.amazonaws.com/Adminpanel/AdminLogin.html";
        }, 45000);
    }


    window.onload = showSpinnerAndRedirect;












    function updateProfileWithName(name) {
        const profileSpan = document.getElementById('profile-username');
        const profileusernames = document.getElementById('profile-usernames')
        if (profileSpan) {
            profileusernames.textContent = name;
            profileSpan.textContent = name;
            localStorage.setItem('username', name);
        } else {
            console.error('Profile username span not found.');
        }
    }


    function getUsernameFromStorage() {
        return localStorage.getItem('username');
    }

    

    function getNameFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('username');
    }



   


   


    function logout(username) {

        const cancelButton = document.querySelector('.logout-Cancel-btn');

        fetch('https://p9p8zffjs0.execute-api.us-east-2.amazonaws.com/Sionyx/Signout-admin', {
            method: 'POST',
            mode: 'no-cors',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username })
        })
            .then(() => {
                cancelButton.classList.remove('disabled')
                localStorage.removeItem('sessionToken');
                localStorage.removeItem('username');
                window.location.href = "AdminLogin.html";
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);
            });
    }

    updateProfileWithName(nameFromURL || storedUsername || '');
    function updateURL(page) {
        const url = new URL(window.location.href);
        url.searchParams.set('page', page);
        window.history.pushState({ path: url.href }, '', url.href);
    }

    function getCurrentPageNumber() {
        const urlParams = new URLSearchParams(window.location.search);
        const page = urlParams.get('page');
        console.log("page number returned from getCurrentPageNumber(): ", page)
        return page ? parseInt(page) : 1; // Default to page 1 if no page parameter is found
    }


    function redirectToCameraDetailsPage(details, page) {
        const queryParams = new URLSearchParams(details);
        const name = getUsernameFromStorage() || getNameFromURL();
        queryParams.append('name', name);
        queryParams.append('page', page);
        window.location.href = `UserDetails.html?${queryParams.toString()}`;
    }

    window.onload = fetchAndPopulateUserList;
    function updateURL(page) {
        const url = new URL(window.location.href);
        url.searchParams.set('page', page);
        window.history.pushState({ path: url.href }, '', url.href);
    }
    document.addEventListener('DOMContentLoaded', function () {
        const usernameFromURL = getNameFromURL();
        if (usernameFromURL) {
            updateProfileWithName(usernameFromURL);
        }
        
        if (!localStorage.getItem('sessionToken')) {
            window.location.href = "AdminLogin.html";
        } else {
            fetchAndPopulateUserList();
        }
    });
    




    function getCurrentPageNumber() {
        const urlParams = new URLSearchParams(window.location.search);
        const page = urlParams.get('page');
        return page ? parseInt(page) : 1;
    }
    function getNameFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('username');
    }



    function updateProfileWithName(name) {
        const profileSpan = document.getElementById('profile-username');
        const profileusernames = document.getElementById('profile-usernames')
        if (profileSpan) {
            profileusernames.textContent = name;
            profileSpan.textContent = name;
            localStorage.setItem('username', name);
        } else {
            console.error('Profile username span not found.');
        }
    }


    function getUsernameFromStorage() {
        return localStorage.getItem('username');
    }

    const nameFromURL = getNameFromURL();
    const storedUsername = getUsernameFromStorage();
    if (storedUsername) {
        updateProfileWithName(storedUsername);
    }


    function logout(username) {

        const cancelButton = document.querySelector('.logout-Cancel-btn');

        fetch('https://p9p8zffjs0.execute-api.us-east-2.amazonaws.com/Sionyx/Signout-admin', {
            method: 'POST',
            mode: 'no-cors',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username })
        })
            .then(() => {
                cancelButton.classList.remove('disabled')
                localStorage.removeItem('sessionToken');
                localStorage.removeItem('username');
                window.location.href = "AdminLogin.html";
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);
            });
    }

    updateProfileWithName(nameFromURL || storedUsername || '');
    function updateURL(page) {
        const url = new URL(window.location.href);
        url.searchParams.set('page', page);
        window.history.pushState({ path: url.href }, '', url.href);
    }

    function getCurrentPageNumber() {
        const urlParams = new URLSearchParams(window.location.search);
        const page = urlParams.get('page');
        console.log("page number returned from getCurrentPageNumber(): ", page)
        return page ? parseInt(page) : 1; // Default to page 1 if no page parameter is found
    }


    function redirectToCameraDetailsPage(details, page) {
        const queryParams = new URLSearchParams(details);
        const name = getUsernameFromStorage() || getNameFromURL();
        queryParams.append('name', name);
        queryParams.append('page', page);
        window.location.href = `UserDetails.html?${queryParams.toString()}`;
    }

    window.onload = fetchAndPopulateUserList;
    function updateURL(page) {
        const url = new URL(window.location.href);
        url.searchParams.set('page', page);
        window.history.pushState({ path: url.href }, '', url.href);
    }





    function getCurrentPageNumber() {
        const urlParams = new URLSearchParams(window.location.search);
        const page = urlParams.get('page');
        return page ? parseInt(page) : 1;
    }













</script>